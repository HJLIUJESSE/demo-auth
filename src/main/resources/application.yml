spring:
  datasource:
    # 連線採 Cloud SQL Java Connector（MySQL）
    # 組合方式：jdbc:mysql:///<DB_NAME>?cloudSqlInstance=<PROJECT:REGION:INSTANCE>&socketFactory=com.google.cloud.sql.mysql.SocketFactory&useSSL=false
    # 可直接以 SPRING_DATASOURCE_URL 全覆蓋；否則使用下方 app.* 參數組成
    url: ${SPRING_DATASOURCE_URL:jdbc:mysql:///${app.db.name}?cloudSqlInstance=${app.cloudsql.instance}&socketFactory=com.google.cloud.sql.mysql.SocketFactory&useSSL=false}
    username: ${SPRING_DATASOURCE_USERNAME:root}
    password: ${SPRING_DATASOURCE_PASSWORD:}
    driver-class-name: com.mysql.cj.jdbc.Driver

  jpa:
    show-sql: true
    hibernate:
      ddl-auto: update
    properties:
      hibernate:
        physical_strategy: org.hibernate.boot.model.naming.PhysicalNamingStrategyStandardImpl
        dialect: org.hibernate.dialect.MySQLDialect

server:
  port: 8080

# 應用層設定（便於組合 URL 與 CORS）
app:
  db:
    name: ${DB_NAME:zapp_demo_db}
  cloudsql:
    instance: ${CLOUD_SQL_INSTANCE:}
  cors:
    allowed-origins: ${CORS_ALLOWED_ORIGINS:http://localhost:5173}
  # 以下為一般應用設定預設值（可被 profile 覆蓋）
  password-reset:
    return-token-in-response: false
  mail:
    enabled: false
    from: ${APP_MAIL_FROM:noreply@localhost}
    fromName: ${APP_MAIL_FROM_NAME:Demo App}
    sandbox:
      enabled: ${APP_MAIL_SANDBOX_ENABLED:false}
      recipient: ${APP_MAIL_SANDBOX_RECIPIENT:}
    allowlist: ${APP_MAIL_ALLOWLIST:}
    reply-to: ${APP_MAIL_REPLY_TO:}
    support-url: ${APP_MAIL_SUPPORT_URL:https://example.com/support}
  frontend:
    reset-base-url: ${APP_RESET_BASE_URL:http://localhost:5173/reset-password?token=}

  rate-limit:
    forgot-password:
      max-per-window: ${APP_RATE_FP_MAX:5}
      window-seconds: ${APP_RATE_FP_WINDOW:900}

jwt:
  # 不在檔案中寫死，請用環境變數提供；未設定會導致啟動失敗（JWT 金鑰太短）
  secret: ${JWT_SECRET:}
  expiration-minutes: ${JWT_EXPIRATION_MINUTES:120}

# Actuator 最小化設定：僅暴露 health，預設 base-path /actuator
management:
  endpoints:
    web:
      exposure:
        include: health
